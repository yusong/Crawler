(function() {

	var mongo = require('mongodb');
	var Saver = require('./saver');

	var saver = Saver.getSavers();

	console.dir(saver);

	var handler = function() {};

	// @param data = {
	// 		urls : ['url', 'url']
	// }

	// @param callback(err, newTasks, fin){}
	// 
	// Send newTasks to Callback If Has new task,
	// Sometimes It Is No Need to Send newTasks Such as Product Info Page.
	//
	// @@param newTasks = [
	// 			{
	//				product : {},
	// 				urls : ['url', 'url']
	// 			}
	// 	   ]
	handler.prototype.jingdong = function(data, callback, finish) {
		if( data.product ) {
			saver['jingdong'].push(data.product);
		}

		if( data.pages ) {
			data.pages.forEach(function(pageItem) {
				saver['tasks'].push(pageItem);
			});
		}

		// var saveTaskItem = {
		// 	tasks : [{
		// 		handler : 'jingdong',
		// 		urls : data.urls
		// 	}]			
		// };
		// saver['tasks'].push(saveTaskItem);
		if( data.urls ) {
			callback(true, [data]);
		}
		
		finish();
	};


	handler.prototype.tmall = function(data, callback, finish) {
		if( data.product ) {
			if( data.product.category.constructor === Array && data.product.category.length > 0 ) {
				var saver_name = Saver.getColl('tmall', data.product.category[0]);
				saver[saver_name].push(data.product);
			}
			else {
				saver['tmall'].push(data.product);
			}
		}

		if( data.pages ) {
			data.pages.forEach(function(pageItem) {
				saver['tasks'].push(pageItem);
			});
		}

		// var saveTaskItem = {
		// 	tasks : [{
		// 		handler : 'jingdong',
		// 		urls : data.urls
		// 	}]			
		// };
		// saver['tasks'].push(saveTaskItem);
		if( data.urls ) {
			callback(true, [data]);
		}
		
		finish();
	};


	handler.prototype.weibo = function(data, callback, finish) {
		finish();
	}

	exports.handler = handler;

}());
